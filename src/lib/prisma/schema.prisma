// Configurações do Gerador e Datasource
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// --- MODELO DE PERFIL (CENTRAL) ---
model Profile {
  id                  String   @id @default(uuid())
  userId              String   @unique @map("user_id")
  facillitId          String?  @unique @map("facillit_id") // Identificador Institucional FHB-XXXX-YXY-YYY
  handle              String?  @unique // @username único no sistema
  name                String   @map("full_name")
  bio                 String?
  avatarUrl           String?  @map("avatar_url")
  
  // Campos de Identidade e Contexto
  pronouns            String?
  gender              String?
  address             Json?    @map("address") // Estrutura AddressData persistida como JSONB
  accountType         String   @default("individual") @map("account_type")
  onboardingCompleted Boolean  @default(false) @map("onboarding_completed")

  // Metadados de I.A. e Preferências
  aiLevel             Int      @default(0) @map("ai_level") // 0: moderate, 1: intermediate, 2: advanced
  aiPreferences       Json     @default("{}") @map("ai_preferences") // data_sharing, personalization, etc.
  deviceSettings      Json     @default("{}") @map("device_settings") // trusted, notifications

  // Relações Sociais (Seguidores e Seguindo)
  followers           Follows[] @relation("following")
  following           Follows[] @relation("follower")
  
  // Outras Relações
  privacy             ProfilePrivacy?
  posts               Post[]

  // Timestamps
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  @@map("profiles")
}

// --- PRIVACIDADE DO PERFIL ---
model ProfilePrivacy {
  id            String  @id @default(uuid())
  profileId     String  @unique @map("profile_id")
  profile       Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  isPublic      Boolean @default(true)  @map("is_public")
  showEmail     Boolean @default(false) @map("show_email")
  showLocation  Boolean @default(true)  @map("show_location")
  showEducation Boolean @default(true)  @map("show_education")
  allowMessages Boolean @default(true)  @map("allow_messages")

  @@map("profile_privacy")
}

// --- SISTEMA DE SEGUIDORES (SELF-RELATION) ---
model Follows {
  followerId  String  @map("follower_id")
  followingId String  @map("following_id")
  
  follower    Profile @relation("follower", fields: [followerId], references: [id], onDelete: Cascade)
  following   Profile @relation("following", fields: [followingId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now()) @map("created_at")

  @@id([followerId, followingId])
  @@map("social_follows")
}

// --- POSTAGENS ---
model Post {
  id        String   @id @default(uuid())
  profileId String   @map("profile_id")
  profile   Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  content   String?
  mediaUrl  String?  @map("media_url")
  likes     Int      @default(0)
  
  createdAt DateTime @default(now()) @map("created_at")

  @@map("social_posts")
}

// --- ORGANIZAÇÕES (ESTRUTURA B2B/B2G) ---
model Organization {
  id        String   @id @default(uuid())
  name      String
  type      String   // school | startup | enterprise
  createdAt DateTime @default(now()) @map("created_at")

  @@map("organizations")
}